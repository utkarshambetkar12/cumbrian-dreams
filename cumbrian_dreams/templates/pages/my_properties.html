{% extends "templates/web.html" %}
{% block page_title %}My Properties · Cumbrian Dreams{% endblock %}
{% block page_content %}

<style>
  .cd-wrap{max-width:1040px;margin:0 auto}
  .cd-card{background:#fff;border:1px solid #eee;border-radius:14px;padding:14px}
  table{width:100%;border-collapse:collapse}
  th,td{text-align:left;padding:.5rem;border-bottom:1px solid #eee}
  .cd-btn{display:inline-block;border:0;border-radius:10px;padding:.45rem .75rem;text-decoration:none;font-size:.95rem;cursor:pointer}
  .cd-primary{background:#4f46e5;color:#fff}
  .cd-secondary{background:#eef;color:#223}
  .cd-muted{color:#666}.cd-tiny{font-size:.8rem;color:#999}
  .cd-input{width:100%;padding:.5rem .6rem;border-radius:10px;border:1px solid #ddd}
</style>

<div class="cd-wrap">
  <div class="cd-card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:.5rem;">
      <h2 style="margin:0">My Properties</h2>
      <div style="display:flex;gap:.5rem;align-items:center;">
        {% if is_system_manager %}
          <form method="get" action="/my_properties" style="display:flex;gap:.5rem;align-items:center;">
            <select class="cd-input" name="host">
              <option value="">(All hosts)</option>
              {% for h in hosts %}
                <option value="{{ h.name }}" {% if host_filter == h.name %}selected{% endif %}>
                  {{ h.full_name or h.email or h.name }} ({{ h.name }})
                </option>
              {% endfor %}
            </select>
            <button class="cd-btn cd-secondary" type="submit">Filter</button>
          </form>
        {% endif %}
        <a class="cd-btn cd-primary" href="/create_property">Create Property</a>
      </div>
    </div>

    {% if props and props|length %}
      <div class="cd-tiny cd-muted" style="margin:.5rem 0;">{{ props|length }} property(ies) found.</div>
      <table>
        <thead>
          <tr>
            <th>Title</th>
            <th>Location</th>
            <th>Price/Night</th>
            <th>Host</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for p in props %}
            <tr>
              <td>
                <div><strong>{{ p.title }}</strong></div>
                <div class="cd-tiny cd-muted">{{ p.name }}</div>
              </td>
              <td>{{ p.location }}</td>
              <td>₹{{ p.price_per_night }}</td>
              <td>{{ p.host }}</td>
              <td style="text-align:right;">
                <a class="cd-btn cd-secondary" href="/property?name={{ p.name }}">View</a>
                <a class="cd-btn cd-primary" href="/edit_property?name={{ p.name }}">Edit</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="cd-muted">No properties yet.</div>
    {% endif %}
  </div>
</div>

{% endblock %}
